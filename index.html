<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>前进小学五年级上册英语Module4单词测试</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
        }
        
        body {
            background-color: #fff8f0;
            color: #5a4a42;
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            background: linear-gradient(135deg, #ff9a5a 0%, #ff6f61 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(255, 111, 97, 0.3);
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }
        
        .credit {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .panel {
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-left: 6px solid #ff9a5a;
        }
        
        .panel h2 {
            color: #ff6f61;
            margin-bottom: 20px;
            font-size: 1.6rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panel h2 i {
            color: #ff9a5a;
        }
        
        .word-lists {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .unit {
            background-color: #fff5eb;
            padding: 20px;
            border-radius: 10px;
            border: 2px dashed #ffcc99;
        }
        
        .unit h3 {
            color: #ff7c43;
            margin-bottom: 15px;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 2px solid #ffcc99;
        }
        
        .word-category {
            margin-bottom: 15px;
        }
        
        .category-title {
            font-weight: bold;
            color: #ff6f61;
            margin-bottom: 8px;
            font-size: 1.05rem;
        }
        
        .word-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 10px;
            margin-bottom: 5px;
            background-color: white;
            border-radius: 8px;
            border-left: 4px solid #ffcc99;
        }
        
        .word-eng {
            font-weight: bold;
            color: #5a4a42;
        }
        
        .word-chn {
            color: #8a7a72;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        button {
            background: linear-gradient(to right, #ff9a5a, #ff7c43);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 8px rgba(255, 111, 97, 0.3);
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(255, 111, 97, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .test-area {
            display: none;
        }
        
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            background-color: #fff5eb;
            padding: 15px;
            border-radius: 10px;
        }
        
        .score-display {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ff6f61;
        }
        
        .question {
            background-color: #fff5eb;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #ffcc99;
        }
        
        .question-number {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ff7c43;
            margin-bottom: 15px;
        }
        
        .question-text {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: #5a4a42;
        }
        
        .options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        @media (max-width: 768px) {
            .options {
                grid-template-columns: 1fr;
            }
        }
        
        .option {
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid #ffcc99;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .option:hover {
            background-color: #fff5eb;
            transform: translateY(-3px);
        }
        
        .option.selected {
            background-color: #ffebe6;
            border-color: #ff6f61;
        }
        
        .option.correct {
            background-color: #e6ffe6;
            border-color: #5cd65c;
        }
        
        .option.incorrect {
            background-color: #ffe6e6;
            border-color: #ff6666;
        }
        
        .option input {
            transform: scale(1.2);
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
        }
        
        .result-panel {
            display: none;
            text-align: center;
        }
        
        .result-score {
            font-size: 4rem;
            color: #ff6f61;
            font-weight: bold;
            margin: 20px 0;
        }
        
        .result-message {
            font-size: 1.5rem;
            margin-bottom: 30px;
            color: #5a4a42;
        }
        
        .progress-bar {
            height: 20px;
            background-color: #f0f0f0;
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #ff9a5a, #ff6f61);
            width: 0%;
            transition: width 1s ease;
        }
        
        .record-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .record-table th, .record-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ffcc99;
        }
        
        .record-table th {
            background-color: #fff5eb;
            color: #ff6f61;
        }
        
        .record-table tr:hover {
            background-color: #fffaf5;
        }
        
        .correct-answer {
            color: #5cd65c;
            font-weight: bold;
        }
        
        .incorrect-answer {
            color: #ff6666;
            font-weight: bold;
        }
        
        .download-btn {
            background: linear-gradient(to right, #5cd65c, #2eb82e);
            margin: 20px auto;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            color: #8a7a72;
            font-size: 0.9rem;
            padding-top: 20px;
            border-top: 1px solid #ffcc99;
        }
        
        .toggle-btn {
            background: #ffcc99;
            color: #5a4a42;
            padding: 8px 15px;
            font-size: 0.9rem;
        }
        
        .back-btn {
            background: #8a7a72;
        }
    </style>
</head>
<body>
    <header>
        <h1><i class="fas fa-graduation-cap"></i> 前进小学五年级上册英语Module4单词测试</h1>
        <div class="subtitle">Unit7 Do you want coffee or tea? & Unit8 Let's have both</div>
        <div class="credit">制作单位：广州市花都区狮岭镇前进小学英语科组</div>
    </header>
    
    <div class="container">
        <div class="panel" id="wordReview">
            <h2><i class="fas fa-book-open"></i> 单词复习</h2>
            <div class="word-lists">
                <div class="unit">
                    <h3>Unit 7: Do you want coffee or tea?</h3>
                    
                    <div class="word-category">
                        <div class="category-title">可数名词(词组):</div>
                        <div class="word-item">
                            <span class="word-eng">drink</span>
                            <span class="word-chn">饮料</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">cup</span>
                            <span class="word-chn">杯</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">bottle</span>
                            <span class="word-chn">瓶子</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">glass</span>
                            <span class="word-chn">玻璃杯</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">can</span>
                            <span class="word-chn">罐</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">a cup of...</span>
                            <span class="word-chn">一杯……</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">a bottle of...</span>
                            <span class="word-chn">一瓶……</span>
                        </div>
                    </div>
                    
                    <div class="word-category">
                        <div class="category-title">不可数名词:</div>
                        <div class="word-item">
                            <span class="word-eng">coffee</span>
                            <span class="word-chn">咖啡</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">tea</span>
                            <span class="word-chn">茶</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">juice</span>
                            <span class="word-chn">果汁</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">milk</span>
                            <span class="word-chn">牛奶</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">coke</span>
                            <span class="word-chn">可乐</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">water</span>
                            <span class="word-chn">水</span>
                        </div>
                    </div>
                    
                    <div class="word-category">
                        <div class="category-title">动词:</div>
                        <div class="word-item">
                            <span class="word-eng">drink</span>
                            <span class="word-chn">喝</span>
                        </div>
                    </div>
                    
                    <div class="word-category">
                        <div class="category-title">形容词:</div>
                        <div class="word-item">
                            <span class="word-eng">cold</span>
                            <span class="word-chn">冷的</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">hot</span>
                            <span class="word-chn">热的；辣的</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">sure</span>
                            <span class="word-chn">肯定的</span>
                        </div>
                    </div>
                    
                    <div class="word-category">
                        <div class="category-title">代词:</div>
                        <div class="word-item">
                            <span class="word-eng">something</span>
                            <span class="word-chn">某事，某物</span>
                        </div>
                    </div>
                </div>
                
                <div class="unit">
                    <h3>Unit 8: Let's have both</h3>
                    
                    <div class="word-category">
                        <div class="category-title">可数名词:</div>
                        <div class="word-item">
                            <span class="word-eng">dumpling</span>
                            <span class="word-chn">饺子</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">noodle</span>
                            <span class="word-chn">面条</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">chips</span>
                            <span class="word-chn">炸薯条</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">sandwich</span>
                            <span class="word-chn">三明治</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">egg</span>
                            <span class="word-chn">蛋；鸡蛋</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">hamburger</span>
                            <span class="word-chn">汉堡包</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">potato</span>
                            <span class="word-chn">马铃薯</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">tomato</span>
                            <span class="word-chn">西红柿</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">vegetable</span>
                            <span class="word-chn">蔬菜</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">starter</span>
                            <span class="word-chn">第一道菜；前菜</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">main course</span>
                            <span class="word-chn">主菜</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">dessert</span>
                            <span class="word-chn">甜品</span>
                        </div>
                    </div>
                    
                    <div class="word-category">
                        <div class="category-title">不可数名词:</div>
                        <div class="word-item">
                            <span class="word-eng">rice</span>
                            <span class="word-chn">米</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">bread</span>
                            <span class="word-chn">面包</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">soup</span>
                            <span class="word-chn">汤</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">meat</span>
                            <span class="word-chn">肉</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">chocolate</span>
                            <span class="word-chn">巧克力</span>
                        </div>
                    </div>
                    
                    <div class="word-category">
                        <div class="category-title">形容词:</div>
                        <div class="word-item">
                            <span class="word-eng">main</span>
                            <span class="word-chn">主要的</span>
                        </div>
                    </div>
                    
                    <div class="word-category">
                        <div class="category-title">动词:</div>
                        <div class="word-item">
                            <span class="word-eng">ask</span>
                            <span class="word-chn">问</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">should</span>
                            <span class="word-chn">应该</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">shouldn't</span>
                            <span class="word-chn">不应该 (should not)</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">enjoy</span>
                            <span class="word-chn">欣赏</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">worry</span>
                            <span class="word-chn">担心</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">hope</span>
                            <span class="word-chn">希望</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">start</span>
                            <span class="word-chn">开始；出发</span>
                        </div>
                    </div>
                    
                    <div class="word-category">
                        <div class="category-title">代词:</div>
                        <div class="word-item">
                            <span class="word-eng">both</span>
                            <span class="word-chn">(两者)都</span>
                        </div>
                        <div class="word-item">
                            <span class="word-eng">everyone</span>
                            <span class="word-chn">每一个人；所有人</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="controls">
                <button id="startTestBtn">
                    <i class="fas fa-play-circle"></i> 开始测试
                </button>
                <button id="toggleWordsBtn" class="toggle-btn">
                    <i class="fas fa-eye-slash"></i> 隐藏单词
                </button>
            </div>
        </div>
        
        <div class="panel test-area" id="testArea">
            <h2><i class="fas fa-pencil-alt"></i> 单词测试</h2>
            <div class="test-header">
                <div class="score-display">得分: <span id="currentScore">0</span>/100</div>
                <div class="progress-info">进度: <span id="currentQuestionNum">1</span>/25</div>
            </div>
            
            <div id="questionContainer"></div>
            
            <div class="navigation">
                <button id="prevBtn" class="back-btn">
                    <i class="fas fa-arrow-left"></i> 上一题
                </button>
                <button id="nextBtn">
                    下一题 <i class="fas fa-arrow-right"></i>
                </button>
                <button id="submitTestBtn" class="download-btn">
                    <i class="fas fa-check-circle"></i> 提交测试
                </button>
            </div>
        </div>
        
        <div class="panel result-panel" id="resultPanel">
            <h2><i class="fas fa-chart-line"></i> 测试结果</h2>
            
            <div class="result-score" id="finalScore">0</div>
            <div class="result-message" id="resultMessage"></div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <div id="resultDetails"></div>
            
            <button id="downloadRecordBtn" class="download-btn">
                <i class="fas fa-download"></i> 下载学习记录
            </button>
            <button id="restartTestBtn">
                <i class="fas fa-redo"></i> 重新测试
            </button>
            <button id="backToReviewBtn" class="back-btn">
                <i class="fas fa-book"></i> 返回复习
            </button>
        </div>
    </div>
    
    <div class="footer">
        <p>前进小学英语科组 &copy; 2023 | 本工具适用于广州版五年级上册英语Module4单词学习</p>
        <p>提示：每次测试题目随机生成，可以多次练习巩固记忆</p>
    </div>

    <script>
        // 单词数据
        const wordData = {
            unit7: [
                { english: "drink", chinese: "饮料", type: "可数名词(词组)" },
                { english: "cup", chinese: "杯", type: "可数名词(词组)" },
                { english: "bottle", chinese: "瓶子", type: "可数名词(词组)" },
                { english: "glass", chinese: "玻璃杯", type: "可数名词(词组)" },
                { english: "can", chinese: "罐", type: "可数名词(词组)" },
                { english: "a cup of...", chinese: "一杯……", type: "可数名词(词组)" },
                { english: "a bottle of...", chinese: "一瓶……", type: "可数名词(词组)" },
                { english: "coffee", chinese: "咖啡", type: "不可数名词" },
                { english: "tea", chinese: "茶", type: "不可数名词" },
                { english: "juice", chinese: "果汁", type: "不可数名词" },
                { english: "milk", chinese: "牛奶", type: "不可数名词" },
                { english: "coke", chinese: "可乐", type: "不可数名词" },
                { english: "water", chinese: "水", type: "不可数名词" },
                { english: "drink", chinese: "喝", type: "动词" },
                { english: "cold", chinese: "冷的", type: "形容词" },
                { english: "hot", chinese: "热的；辣的", type: "形容词" },
                { english: "sure", chinese: "肯定的", type: "形容词" },
                { english: "something", chinese: "某事，某物", type: "代词" }
            ],
            unit8: [
                { english: "dumpling", chinese: "饺子", type: "可数名词" },
                { english: "noodle", chinese: "面条", type: "可数名词" },
                { english: "chips", chinese: "炸薯条", type: "可数名词" },
                { english: "sandwich", chinese: "三明治", type: "可数名词" },
                { english: "egg", chinese: "蛋；鸡蛋", type: "可数名词" },
                { english: "hamburger", chinese: "汉堡包", type: "可数名词" },
                { english: "potato", chinese: "马铃薯", type: "可数名词" },
                { english: "tomato", chinese: "西红柿", type: "可数名词" },
                { english: "vegetable", chinese: "蔬菜", type: "可数名词" },
                { english: "starter", chinese: "第一道菜；前菜", type: "可数名词" },
                { english: "main course", chinese: "主菜", type: "可数名词" },
                { english: "dessert", chinese: "甜品", type: "可数名词" },
                { english: "rice", chinese: "米", type: "不可数名词" },
                { english: "bread", chinese: "面包", type: "不可数名词" },
                { english: "soup", chinese: "汤", type: "不可数名词" },
                { english: "meat", chinese: "肉", type: "不可数名词" },
                { english: "chocolate", chinese: "巧克力", type: "不可数名词" },
                { english: "main", chinese: "主要的", type: "形容词" },
                { english: "ask", chinese: "问", type: "动词" },
                { english: "should", chinese: "应该", type: "动词" },
                { english: "shouldn't", chinese: "不应该", type: "动词" },
                { english: "enjoy", chinese: "欣赏", type: "动词" },
                { english: "worry", chinese: "担心", type: "动词" },
                { english: "hope", chinese: "希望", type: "动词" },
                { english: "start", chinese: "开始；出发", type: "动词" },
                { english: "both", chinese: "(两者)都", type: "代词" },
                { english: "everyone", chinese: "每一个人；所有人", type: "代词" }
            ]
        };

        // 合并所有单词
        const allWords = [...wordData.unit7, ...wordData.unit8];
        
        // 测试状态变量
        let testStarted = false;
        let currentQuestionIndex = 0;
        let score = 0;
        let userAnswers = [];
        let testQuestions = [];
        
        // DOM元素
        const wordReviewPanel = document.getElementById('wordReview');
        const testAreaPanel = document.getElementById('testArea');
        const resultPanel = document.getElementById('resultPanel');
        const startTestBtn = document.getElementById('startTestBtn');
        const toggleWordsBtn = document.getElementById('toggleWordsBtn');
        const currentScoreElement = document.getElementById('currentScore');
        const currentQuestionNumElement = document.getElementById('currentQuestionNum');
        const questionContainer = document.getElementById('questionContainer');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitTestBtn = document.getElementById('submitTestBtn');
        const finalScoreElement = document.getElementById('finalScore');
        const resultMessageElement = document.getElementById('resultMessage');
        const progressFillElement = document.getElementById('progressFill');
        const resultDetailsElement = document.getElementById('resultDetails');
        const downloadRecordBtn = document.getElementById('downloadRecordBtn');
        const restartTestBtn = document.getElementById('restartTestBtn');
        const backToReviewBtn = document.getElementById('backToReviewBtn');
        const wordItems = document.querySelectorAll('.word-item');
        
        // 切换单词显示/隐藏
        let wordsVisible = true;
        toggleWordsBtn.addEventListener('click', function() {
            wordsVisible = !wordsVisible;
            wordItems.forEach(item => {
                item.style.display = wordsVisible ? 'flex' : 'none';
            });
            toggleWordsBtn.innerHTML = wordsVisible ? 
                '<i class="fas fa-eye-slash"></i> 隐藏单词' : 
                '<i class="fas fa-eye"></i> 显示单词';
        });
        
        // 开始测试
        startTestBtn.addEventListener('click', startTest);
        
        // 生成随机测试题目
        function generateTestQuestions() {
            testQuestions = [];
            
            // 从所有单词中随机选择25个
            const shuffledWords = [...allWords].sort(() => Math.random() - 0.5);
            const selectedWords = shuffledWords.slice(0, 25);
            
            // 为每个单词生成一个问题
            selectedWords.forEach(word => {
                // 随机决定是英译中还是中译英
                const isEnglishToChinese = Math.random() > 0.5;
                
                // 生成错误选项
                const wrongOptions = generateWrongOptions(word, isEnglishToChinese);
                
                // 创建问题对象
                const question = {
                    word: word,
                    type: isEnglishToChinese ? '英译中' : '中译英',
                    question: isEnglishToChinese ? word.english : word.chinese,
                    correctAnswer: isEnglishToChinese ? word.chinese : word.english,
                    options: []
                };
                
                // 将正确答案和错误选项混合
                const allOptions = [question.correctAnswer, ...wrongOptions];
                shuffleArray(allOptions);
                
                question.options = allOptions;
                testQuestions.push(question);
            });
        }
        
        // 生成错误选项
        function generateWrongOptions(correctWord, isEnglishToChinese) {
            // 过滤掉正确答案
            const otherWords = allWords.filter(w => 
                w.english !== correctWord.english && w.chinese !== correctWord.chinese
            );
            
            // 随机选择3个
            const shuffled = [...otherWords].sort(() => Math.random() - 0.5);
            const selected = shuffled.slice(0, 3);
            
            // 根据题目类型返回错误选项
            return selected.map(word => 
                isEnglishToChinese ? word.chinese : word.english
            );
        }
        
        // 数组洗牌函数
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // 开始测试
        function startTest() {
            testStarted = true;
            currentQuestionIndex = 0;
            score = 0;
            userAnswers = new Array(25).fill(null);
            
            // 生成题目
            generateTestQuestions();
            
            // 切换面板显示
            wordReviewPanel.style.display = 'none';
            testAreaPanel.style.display = 'block';
            resultPanel.style.display = 'none';
            
            // 更新分数显示
            updateScoreDisplay();
            
            // 显示第一题
            showQuestion(currentQuestionIndex);
        }
        
        // 显示问题
        function showQuestion(index) {
            const question = testQuestions[index];
            
            // 更新进度显示
            currentQuestionNumElement.textContent = index + 1;
            
            // 构建问题HTML
            let questionHTML = `
                <div class="question">
                    <div class="question-number">第 ${index + 1} 题 (${question.type})</div>
                    <div class="question-text">"${question.question}" 的中文/英文意思是什么？</div>
                    <div class="options">
            `;
            
            // 添加选项
            question.options.forEach((option, i) => {
                const optionId = `option_${index}_${i}`;
                let optionClass = "option";
                
                // 检查用户是否已选择此选项
                if (userAnswers[index] === option) {
                    optionClass += " selected";
                }
                
                questionHTML += `
                    <div class="${optionClass}" data-option="${option}">
                        <input type="radio" id="${optionId}" name="question_${index}" value="${option}">
                        <label for="${optionId}">${option}</label>
                    </div>
                `;
            });
            
            questionHTML += `
                    </div>
                </div>
            `;
            
            questionContainer.innerHTML = questionHTML;
            
            // 为选项添加点击事件
            document.querySelectorAll('.option').forEach(option => {
                option.addEventListener('click', function() {
                    const selectedOption = this.getAttribute('data-option');
                    
                    // 清除同一问题的其他选项的选择状态
                    document.querySelectorAll(`.question .option`).forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // 标记当前选项为选中
                    this.classList.add('selected');
                    
                    // 保存用户答案
                    userAnswers[index] = selectedOption;
                    
                    // 自动进入下一题（如果是最后一题则不自动跳转）
                    if (index < 24) {
                        setTimeout(() => {
                            currentQuestionIndex++;
                            showQuestion(currentQuestionIndex);
                            updateScoreDisplay();
                        }, 300);
                    }
                });
            });
            
            // 更新按钮状态
            prevBtn.disabled = index === 0;
            nextBtn.disabled = index === 24;
        }
        
        // 更新分数显示
        function updateScoreDisplay() {
            // 计算当前得分
            let calculatedScore = 0;
            
            for (let i = 0; i < testQuestions.length; i++) {
                if (userAnswers[i] === testQuestions[i].correctAnswer) {
                    calculatedScore += 4;
                }
            }
            
            score = calculatedScore;
            currentScoreElement.textContent = score;
        }
        
        // 上一题按钮
        prevBtn.addEventListener('click', function() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion(currentQuestionIndex);
            }
        });
        
        // 下一题按钮
        nextBtn.addEventListener('click', function() {
            if (currentQuestionIndex < 24) {
                currentQuestionIndex++;
                showQuestion(currentQuestionIndex);
            }
        });
        
        // 提交测试
        submitTestBtn.addEventListener('click', function() {
            // 检查是否所有题目都已回答
            const unanswered = userAnswers.filter(answer => answer === null).length;
            
            if (unanswered > 0) {
                if (confirm(`您还有 ${unanswered} 道题未回答，确定要提交吗？`)) {
                    showResults();
                }
            } else {
                showResults();
            }
        });
        
        // 显示结果
        function showResults() {
            // 计算最终得分
            updateScoreDisplay();
            
            // 切换面板显示
            wordReviewPanel.style.display = 'none';
            testAreaPanel.style.display = 'none';
            resultPanel.style.display = 'block';
            
            // 显示分数
            finalScoreElement.textContent = score;
            
            // 显示评语
            let message = "";
            if (score >= 90) {
                message = "太棒了！你掌握得非常扎实！";
            } else if (score >= 80) {
                message = "很好！你对这些单词很熟悉！";
            } else if (score >= 60) {
                message = "不错！继续努力会有更大进步！";
            } else {
                message = "需要多加复习哦，相信下次会更好！";
            }
            resultMessageElement.textContent = message;
            
            // 更新进度条
            progressFillElement.style.width = `${score}%`;
            
            // 显示详细结果
            showResultDetails();
        }
        
        // 显示详细结果
        function showResultDetails() {
            let detailsHTML = `
                <h3 style="margin-top: 30px; color: #ff7c43;">答题详情</h3>
                <table class="record-table">
                    <thead>
                        <tr>
                            <th>题号</th>
                            <th>单词</th>
                            <th>题目</th>
                            <th>你的答案</th>
                            <th>正确答案</th>
                            <th>得分</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            for (let i = 0; i < testQuestions.length; i++) {
                const question = testQuestions[i];
                const userAnswer = userAnswers[i];
                const isCorrect = userAnswer === question.correctAnswer;
                const point = isCorrect ? 4 : 0;
                
                detailsHTML += `
                    <tr>
                        <td>${i + 1}</td>
                        <td>${question.word.english}</td>
                        <td>${question.type}: ${question.question}</td>
                        <td class="${isCorrect ? 'correct-answer' : 'incorrect-answer'}">
                            ${userAnswer || '未回答'}
                        </td>
                        <td>${question.correctAnswer}</td>
                        <td>${point}</td>
                    </tr>
                `;
            }
            
            detailsHTML += `
                    </tbody>
                </table>
            `;
            
            resultDetailsElement.innerHTML = detailsHTML;
        }
        
        // 下载学习记录
        downloadRecordBtn.addEventListener('click', function() {
            // 创建CSV内容
            let csvContent = "前进小学五年级上册英语Module4单词测试记录\n";
            csvContent += `测试时间：${new Date().toLocaleString()}\n`;
            csvContent += `得分：${score}/100\n\n`;
            csvContent += "题号,单词,题目类型,题目内容,你的答案,正确答案,得分\n";
            
            for (let i = 0; i < testQuestions.length; i++) {
                const question = testQuestions[i];
                const userAnswer = userAnswers[i];
                const isCorrect = userAnswer === question.correctAnswer;
                const point = isCorrect ? 4 : 0;
                
                csvContent += `${i + 1},${question.word.english},${question.type},"${question.question}","${userAnswer || '未回答'}","${question.correctAnswer}",${point}\n`;
            }
            
            // 添加总结
            csvContent += `\n总计：${score}/100\n`;
            csvContent += `正确率：${(score/100*100).toFixed(1)}%\n`;
            csvContent += `制作单位：广州市花都区狮岭镇前进小学英语科组\n`;
            
            // 创建Blob并下载
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', `前进小学Module4单词测试_${new Date().toISOString().slice(0,10)}_${score}分.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });
        
        // 重新测试
        restartTestBtn.addEventListener('click', function() {
            startTest();
        });
        
        // 返回复习
        backToReviewBtn.addEventListener('click', function() {
            wordReviewPanel.style.display = 'block';
            testAreaPanel.style.display = 'none';
            resultPanel.style.display = 'none';
            
            // 恢复单词显示
            wordsVisible = true;
            wordItems.forEach(item => {
                item.style.display = 'flex';
            });
            toggleWordsBtn.innerHTML = '<i class="fas fa-eye-slash"></i> 隐藏单词';
        });
        
        // 初始化显示
        window.addEventListener('DOMContentLoaded', function() {
            // 默认显示单词复习面板
            wordReviewPanel.style.display = 'block';
            testAreaPanel.style.display = 'none';
            resultPanel.style.display = 'none';
        });
    </script>
</body>
</html>